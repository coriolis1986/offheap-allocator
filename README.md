## Аллокатор и сборщик мусора

Данная работа представляет собой экспериментальную реализацию аллокатора памяти и сборщика мусора для off-heap памяти JVM.

**Введение**:

Память, используемая JVM разделяется на 2 области: heap (размещает локальные и глобальные объекты) и off-heap (размещает стеки потоков, которые динамически растут, уменьшаются и удаляются по ходу эксплуатации ПО).

Стек и связанные с ним области heap-памяти подвержены регулярному анализу сборщика мусора JVM. Тем самым, при хранении больших (более миллиона) цепочек объектов может оказываться влияние на performance системы.

Интересным было бы использовать область памяти, напрямую не принадлежащую JVM. Таким образом стало бы возможным хранить большие объемы глобальных данных, постоянно хранящиеся в ОЗУ до останова JVM и доступные всем потокам одновременно.

Существует реализация подобного решения: https://www.ehcache.org/ - off-heap кэш, хранящий словари в виде пар key-value.

**Цель**: реализация аллокатора и сборщика мусора

**Задачи**:
- разобраться с механизмами работы off-heap памяти JVM
- реализовать блочный аллокатор для сериализуемых Java-объектов с переиспользованием блоков памяти
- реализовать двухпроходной Garbage Collector для поиска несвязанных "потерянных" объектов, удаления их и объединения удаленных блоков в один

**Реализация**:

Данное тестовое решение представлено в виде Spring-библиотеки и предоставляет единую точку входа в виде бина **AllocatorService**.

Бин реализует следующие основные методы:

- *String set(Serializable obj)* : сохранить объект, предоставить его уникальное имя в хранилище
- *List&lt;Serializable> get(String name)* : получить объект по имени вместе со всеми связанными с ним объектами
- *remove(String name)* : удалить объект по имени, освободить связанные с ним объекты
- *link(String parent, String child)* : привязать объект child к родителю parent
- *free()* :  получить объем свободной памяти в байтах

Отдельно реализован механизм сборки мусора в виде бина **GarbageCollector**.

Бин реализует следующий метод:

- *performGC()* : непосредственно сборка мусора

Сборщик для начала ищет уже удаленные объекты, собирает их блоки памяти и пытается их объединить в бОльшие.

После этого, в качестве второго прохода, ищет цепочки объектов, транзитивно не связанных с корневым и помечает их как удаленные.

Для демонстрации работы реализованы два юнит-теста:

- https://github.com/coriolis1986/offheap-allocator/blob/master/src/test/java/ru/otus/offheap/service/AllocatorServiceTest.java : создание, удаление объектов. Переиспользование удаленных блоков
- https://github.com/coriolis1986/offheap-allocator/blob/master/src/test/java/ru/otus/offheap/service/GarbageCollectorImplTest.java : создание, удаление объектов. Сборка мусора, объединение блоков